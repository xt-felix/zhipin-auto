<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XPath路径测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .test-container {
            border: 1px solid #ccc;
            padding: 20px;
            margin-bottom: 20px;
        }
        .resume-basic-new__meta-item {
            background-color: #e3f2fd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #2196f3;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #results {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>XPath路径测试</h1>
    <p>模拟XPath路径: /html/body/div[4]/div/div[2]/div[2]/div[1]/div</p>
    
    <!-- 模拟XPath结构 -->
    <div>
        <div>
            <div>
                <div>
                    <div>
                        <div class="resume-basic-new__meta-item">
                            <h3>候选人信息 1</h3>
                            <p>姓名: 张三</p>
                            <p>经验: 5年</p>
                        </div>
                    </div>
                </div>
                <div>
                    <div class="resume-basic-new__meta-item">
                        <h3>候选人信息 2</h3>
                        <p>姓名: 李四</p>
                        <p>经验: 3年</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="test-container">
        <h2>测试控件</h2>
        <button onclick="testClassSelector()">测试类选择器查找</button>
        <button onclick="testXPathDirect()">测试直接XPath查找</button>
        <button onclick="testMultipleMethods()">测试多种方法</button>
        <button onclick="clearResults()">清空结果</button>
    </div>
    
    <div id="results">
        <h2>测试结果</h2>
        <div id="output"></div>
    </div>

    <script>
        // 辅助函数：检查元素是否可见
        function isElementVisible(element) {
            if (!element) return false;
            
            // 检查元素本身是否可见
            const style = window.getComputedStyle(element);
            if (style.display === 'none' || style.visibility === 'hidden' || style.opacity === '0') {
                return false;
            }
            
            // 检查元素是否在视口内
            const rect = element.getBoundingClientRect();
            if (rect.width === 0 || rect.height === 0) {
                return false;
            }
            
            return true;
        }

        // 直接XPath查找函数
        function findByXPath(xpath) {
            try {
                const result = document.evaluate(xpath, document, null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null);
                const elements = [];
                for (let i = 0; i < result.snapshotLength; i++) {
                    elements.push(result.snapshotItem(i));
                }
                return elements.filter(el => isElementVisible(el));
            } catch (e) {
                console.error('XPath查找失败:', e);
                return [];
            }
        }

        // 通用元素查找函数（简化版）
        function findElementsByMultipleMethods(selector, options = {}) {
            const {
                includeHidden = false,
                methods = ['all']
            } = options;
            
            // 方法1: querySelectorAll
            if (methods.includes('all') || methods.includes('querySelectorAll')) {
                try {
                    const elements = document.querySelectorAll(selector);
                    let filteredElements = Array.from(elements);
                    
                    if (!includeHidden) {
                        filteredElements = filteredElements.filter(el => isElementVisible(el));
                    }
                    
                    if (filteredElements.length > 0) {
                        return { elements: filteredElements, method: 'querySelectorAll' };
                    }
                } catch (e) {
                    console.log(`querySelectorAll 查询失败:`, e);
                }
            }
            
            // 方法2: getElementsByClassName (如果是类选择器)
            if ((methods.includes('all') || methods.includes('getElementsByClassName')) && selector.startsWith('.')) {
                try {
                    const className = selector.substring(1);
                    const elements = document.getElementsByClassName(className);
                    let filteredElements = Array.from(elements);
                    
                    if (!includeHidden) {
                        filteredElements = filteredElements.filter(el => isElementVisible(el));
                    }
                    
                    if (filteredElements.length > 0) {
                        return { elements: filteredElements, method: 'getElementsByClassName' };
                    }
                } catch (e) {
                    console.log(`getElementsByClassName 查询失败:`, e);
                }
            }
            
            // 方法3: XPath查找
            if (methods.includes('all') || methods.includes('xpath')) {
                try {
                    let xpath = '';
                    if (selector.startsWith('.')) {
                        // 类选择器转XPath
                        const className = selector.substring(1);
                        xpath = `//*[contains(@class, '${className}')]`;
                    } else if (selector.startsWith('#')) {
                        // ID选择器转XPath
                        const id = selector.substring(1);
                        xpath = `//*[@id='${id}']`;
                    } else if (/^[a-zA-Z]/.test(selector)) {
                        // 标签选择器转XPath
                        xpath = `//${selector}`;
                    }
                    
                    if (xpath) {
                        const elements = findByXPath(xpath);
                        if (elements.length > 0) {
                            return { elements: elements, method: 'xpath' };
                        }
                    }
                } catch (e) {
                    console.log(`XPath 查询失败:`, e);
                }
            }
            
            return { elements: [], method: 'none', message: '未找到元素' };
        }

        // 测试类选择器查找
        function testClassSelector() {
            const output = document.getElementById('output');
            output.innerHTML += '<h3>测试类选择器查找</h3>';
            
            const result = findElementsByMultipleMethods('.resume-basic-new__meta-item');
            output.innerHTML += `<p>找到 ${result.elements.length} 个元素 (使用方法: ${result.method})</p>`;
            
            result.elements.forEach((el, index) => {
                output.innerHTML += `<p>元素 ${index + 1}: ${el.textContent.trim()}</p>`;
            });
        }

        // 测试直接XPath查找
        function testXPathDirect() {
            const output = document.getElementById('output');
            output.innerHTML += '<h3>测试直接XPath查找</h3>';
            output.innerHTML += '<p>XPath路径: /html/body/div/div/div/div/div/div</p>';
            
            // 注意：实际的XPath可能需要调整
            const xpath = '/html/body/div/div/div/div/div/div';
            const elements = findByXPath(xpath);
            
            output.innerHTML += `<p>找到 ${elements.length} 个元素</p>`;
            
            elements.forEach((el, index) => {
                output.innerHTML += `<p>元素 ${index + 1}: ${el.textContent.trim()}</p>`;
            });
        }

        // 测试多种方法
        function testMultipleMethods() {
            const output = document.getElementById('output');
            output.innerHTML += '<h3>测试多种方法</h3>';
            
            // 方法1: querySelectorAll
            output.innerHTML += '<p><strong>方法1: querySelectorAll</strong></p>';
            const result1 = findElementsByMultipleMethods('.resume-basic-new__meta-item', { 
                methods: ['querySelectorAll'] 
            });
            output.innerHTML += `<p>找到 ${result1.elements.length} 个元素</p>`;
            
            // 方法2: getElementsByClassName
            output.innerHTML += '<p><strong>方法2: getElementsByClassName</strong></p>';
            const result2 = findElementsByMultipleMethods('.resume-basic-new__meta-item', { 
                methods: ['getElementsByClassName'] 
            });
            output.innerHTML += `<p>找到 ${result2.elements.length} 个元素</p>`;
            
            // 方法3: XPath
            output.innerHTML += '<p><strong>方法3: XPath</strong></p>';
            const result3 = findElementsByMultipleMethods('.resume-basic-new__meta-item', { 
                methods: ['xpath'] 
            });
            output.innerHTML += `<p>找到 ${result3.elements.length} 个元素</p>`;
        }

        // 清空结果
        function clearResults() {
            document.getElementById('output').innerHTML = '';
        }
    </script>
</body>
</html>