# å‰ç«¯ API é€‚é…è¯´æ˜

## æ›´æ–°æ—¥æœŸ
2026-01-16

## æ¦‚è¿°
å‰ç«¯å·²é€‚é… Django åç«¯ APIï¼Œæ‰€æœ‰æ ¸å¿ƒæ¥å£å·²æ›´æ–°ä¸ºæ–°çš„è·¯å¾„æ ¼å¼ï¼ˆå»æ‰ `.php` åç¼€ï¼‰ã€‚

---

## å·²ä¿®æ”¹çš„æ–‡ä»¶

### 1. config.js
**ä¿®æ”¹å†…å®¹**ï¼šæ›´æ–° API_BASE åœ°å€

```javascript
// æ—§é…ç½®
API_BASE: 'https://goodhr.58it.cn',

// æ–°é…ç½®
API_BASE: 'http://127.0.0.1:8000',  // Django å¼€å‘æœåŠ¡å™¨
```

**ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ—¶ä¿®æ”¹ä¸º**ï¼š
```javascript
API_BASE: 'https://your-domain.com',
```

---

### 2. popup/index.js
**ä¿®æ”¹å†…å®¹**ï¼šæ›´æ–° 3 ä¸ª API è°ƒç”¨

| åŸè·¯å¾„ | æ–°è·¯å¾„ | è¡Œå· |
|--------|--------|------|
| `/checkaitrial.php` | `/checkaitrial` | ~1926 |
| `/getjson.php` | `/getjson` | ~2044 |
| `/updatejson.php` | `/updatejson` | ~2896 |

---

### 3. utils/fingerprint-device.js
**ä¿®æ”¹å†…å®¹**ï¼šæ›´æ–° 2 ä¸ª API è°ƒç”¨

| åŸè·¯å¾„ | æ–°è·¯å¾„ | è¡Œå· |
|--------|--------|------|
| `/checkfingerprint.php` | `/checkfingerprint` | ~149 |
| `/checkaitrial.php` | `/checkaitrial` | ~178 |

---

### 4. content_scripts/index.js
**ä¿®æ”¹å†…å®¹**ï¼šæ›´æ–° 1 ä¸ª API è°ƒç”¨

| åŸè·¯å¾„ | æ–°è·¯å¾„ | è¡Œå· |
|--------|--------|------|
| `/counter.php` | `/counter` | ~497 |

---

### 5. background.js
**ä¿®æ”¹å†…å®¹**ï¼šæ·»åŠ æ³¨é‡Šè¯´æ˜å·²å±è”½æ¥å£

```javascript
// è·å–æ‰“èµæ’è¡Œæ¦œæ•°æ®ï¼ˆå·²å±è”½åŠŸèƒ½ï¼Œä¿ç•™ä»£ç ï¼‰
async function fetchRankingData() {
    // æ³¨æ„ï¼šè¯¥æ¥å£å·²è¢«å±è”½ï¼Œä¸å†è°ƒç”¨
    ...
}
```

---

## API è·¯å¾„å¯¹ç…§è¡¨

| åŠŸèƒ½ | åŸ PHP è·¯å¾„ | æ–° Django è·¯å¾„ | çŠ¶æ€ |
|------|-------------|----------------|------|
| è·å–ç”¨æˆ·é…ç½® | `/getjson.php` | `/getjson` | âœ… å·²é€‚é… |
| æ›´æ–°ç”¨æˆ·é…ç½® | `/updatejson.php` | `/updatejson` | âœ… å·²é€‚é… |
| AI è¯•ç”¨æœŸç®¡ç† | `/checkaitrial.php` | `/checkaitrial` | âœ… å·²é€‚é… |
| è®¾å¤‡æŒ‡çº¹æ£€æŸ¥ | `/checkfingerprint.php` | `/checkfingerprint` | âœ… å·²é€‚é… |
| ä½¿ç”¨ç»Ÿè®¡ | `/counter.php` | `/counter` | âœ… å·²é€‚é… |
| ç‰ˆæœ¬æ£€æŸ¥ | `/v.json` | - | ğŸ”’ å·²å±è”½ |
| å¹¿å‘Šé…ç½® | `/ads.json` | - | ğŸ”’ å·²å±è”½ |
| æ‰“èµæ’è¡Œæ¦œ | `/dashang.json` | - | ğŸ”’ å·²å±è”½ |

---

## å“åº”æ ¼å¼å˜åŒ–

### Django åç«¯å“åº”æ ¼å¼

**æˆåŠŸå“åº”**ï¼š
```json
{
  "success": true,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {...}  // å¯é€‰
}
```

**å¤±è´¥å“åº”**ï¼š
```json
{
  "success": false,
  "error": "é”™è¯¯ä¿¡æ¯"
}
```

### éœ€è¦æ³¨æ„çš„å·®å¼‚

1. **ç»Ÿä¸€ä½¿ç”¨ `success` å­—æ®µ**åˆ¤æ–­æˆåŠŸ/å¤±è´¥
2. **é”™è¯¯ä¿¡æ¯**ç»Ÿä¸€åœ¨ `error` å­—æ®µè¿”å›
3. **æ•°æ®å†…å®¹**å¯èƒ½ç›´æ¥è¿”å›æˆ–åœ¨ `data` å­—æ®µä¸­

---

## æµ‹è¯•æ¸…å•

### æœ¬åœ°å¼€å‘ç¯å¢ƒæµ‹è¯•

1. âœ… å¯åŠ¨ Django åç«¯æœåŠ¡
   ```bash
   cd backend
   source venv/bin/activate
   python manage.py runserver
   ```

2. âœ… åŠ è½½ Chrome æ‰©å±•
   - æ‰“å¼€ `chrome://extensions/`
   - å¼€å¯å¼€å‘è€…æ¨¡å¼
   - åŠ è½½ `frontend` ç›®å½•

3. âœ… æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
   - [ ] æ‰‹æœºå·ç»‘å®š
   - [ ] äº‘ç«¯é…ç½®åŒæ­¥ï¼ˆè·å–/ä¿å­˜ï¼‰
   - [ ] AI è¯•ç”¨æœŸæ£€æŸ¥/ç”³è¯·
   - [ ] è®¾å¤‡æŒ‡çº¹éªŒè¯
   - [ ] ä½¿ç”¨ç»Ÿè®¡è®°å½•
   - [ ] å€™é€‰äººç­›é€‰ï¼ˆå…³é”®è¯ï¼‰
   - [ ] AI æ™ºèƒ½ç­›é€‰
   - [ ] è‡ªåŠ¨æ‰“æ‹›å‘¼

---

## å¸¸è§é—®é¢˜

### Q1: CORS è·¨åŸŸé”™è¯¯
**A**: Django åç«¯å·²å†…ç½® CORS æ”¯æŒï¼Œå…è®¸ `*` æ¥æºè®¿é—®ã€‚å¦‚æœä»æœ‰é—®é¢˜ï¼Œæ£€æŸ¥åç«¯æ˜¯å¦æ­£å¸¸è¿è¡Œã€‚

### Q2: æ¥å£è¿”å› 404
**A**: ç¡®è®¤ï¼š
1. API è·¯å¾„æ˜¯å¦å·²å»æ‰ `.php` åç¼€
2. config.js ä¸­ API_BASE æ˜¯å¦æ­£ç¡®
3. Django æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ

### Q3: æ•°æ®æ ¼å¼é”™è¯¯
**A**: Django åç«¯å“åº”æ ¼å¼ä¸ PHP å¯èƒ½ç•¥æœ‰ä¸åŒï¼Œæ£€æŸ¥ï¼š
1. ä½¿ç”¨ `success` å­—æ®µåˆ¤æ–­æ“ä½œç»“æœ
2. é”™è¯¯ä¿¡æ¯åœ¨ `error` å­—æ®µ
3. æ•°æ®å¯èƒ½åœ¨ `config`ã€`data` ç­‰å­—æ®µ

### Q4: è¯•ç”¨æœŸç›¸å…³åŠŸèƒ½å¼‚å¸¸
**A**: æ£€æŸ¥ï¼š
1. è®¾å¤‡æŒ‡çº¹æ˜¯å¦æ­£å¸¸ç”Ÿæˆ
2. `/checkaitrial` æ¥å£æ˜¯å¦æ­£å¸¸è°ƒç”¨
3. åç«¯æ•°æ®åº“æ˜¯å¦æœ‰ç›¸å…³è®°å½•

---

## éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### 1. ä¿®æ”¹ config.js
```javascript
API_BASE: 'https://your-domain.com',  // æ›¿æ¢ä¸ºå®é™…åŸŸå
```

### 2. åç«¯éƒ¨ç½²
å‚è€ƒ [backend/README.md](../backend/README.md) çš„ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ç« èŠ‚ï¼š
- åˆ‡æ¢åˆ° MySQL/PostgreSQL
- è®¾ç½® `DEBUG = False`
- é…ç½® `ALLOWED_HOSTS`
- æ›´æ¢ `SECRET_KEY`

### 3. æ‰“åŒ…æ‰©å±•
```bash
cd frontend
zip -r goodhr-extension.zip . -x "*.git*" "node_modules/*" "*.DS_Store"
```

### 4. å‘å¸ƒåˆ° Chrome åº”ç”¨å•†åº—
æŒ‰ç…§ Chrome Web Store å‘å¸ƒæµç¨‹æäº¤å®¡æ ¸ã€‚

---

## å›æ»šæ–¹æ¡ˆ

å¦‚æœéœ€è¦å›æ»šåˆ°åŸ PHP åç«¯ï¼š

1. ä¿®æ”¹ `config.js`ï¼š
   ```javascript
   API_BASE: 'https://goodhr.58it.cn',
   ```

2. æ¢å¤æ‰€æœ‰ API è·¯å¾„çš„ `.php` åç¼€ï¼š
   - `/getjson` â†’ `/getjson.php`
   - `/updatejson` â†’ `/updatejson.php`
   - `/checkaitrial` â†’ `/checkaitrial.php`
   - `/checkfingerprint` â†’ `/checkfingerprint.php`
   - `/counter` â†’ `/counter.php`

---

## æŠ€æœ¯æ”¯æŒ

- **åç«¯æ–‡æ¡£**: [backend/README.md](../backend/README.md)
- **API è§„èŒƒ**: [backend/API_SPEC.md](../backend/API_SPEC.md)
- **GitHub Issues**: [é¡¹ç›®åœ°å€]/issues
